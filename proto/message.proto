syntax = "proto3";
package im;

option cc_enable_arenas = true;

import "auth_service.proto";

// CommandType determines which structure the Envelope's oneof unpacks into
enum CommandType {
    CMD_UNKNOWN       = 0;

    // Auth commands
    CMD_REGISTER_REQ  = 1;
    CMD_REGISTER_RES  = 2;
    CMD_LOGIN_REQ     = 3;
    CMD_LOGIN_RES     = 4;

    // Message commands
    CMD_P2P_MSG_REQ   = 50; // P2P message request (Client -> Server)
    CMD_P2P_MSG_PUSH  = 51; // P2P message push (Server -> Client)
    CMD_MSG_ACK       = 52; // Generic message acknowledgment (Server -> Client)
}

// Envelope is the top-level message structure
message Envelope {
    uint64 seq = 1;            // Sequence number for full-duplex link tracing
    CommandType cmd = 2;       // CommandType enum
    int64 timestamp = 3;       // Server timestamp

    oneof payload {
        RegisterReq register_req = 100;
        RegisterResp register_res = 101;
        LoginReq login_req = 102;
        LoginResp login_res = 103;
    }
}

// ContentType determines how to parse the content field
enum ContentType {
    CONTENT_TEXT    = 0;
}

// Message structure for P2P communication
message P2PMessage {
    string msg_id = 1;
    int64 sender_id = 2;
    int64 receiver_id = 3;
    ContentType content_type = 4; 
    bytes content = 5;         
}

// Message acknowledgment structure
message MessageAck {
    string msg_id = 1;
    uint64 ref_seq = 2;
    bool success = 3;
    string error_msg = 4;
}